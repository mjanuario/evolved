<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Birth-death models and molecular phylogenies • evolved</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Birth-death models and molecular phylogenies">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">evolved</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-book"></span> Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html"><span class="fa fa-book-open"></span> Vignettes &amp; Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mjanuario/evolved" aria-label="GitHub repository"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Birth-death models and molecular phylogenies</h1>
                        <h4 data-toc-skip class="author">Matheus
Januario, Andressa Viol, and Daniel Rabosky</h4>
            
            <h4 data-toc-skip class="date">Jan 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mjanuario/evolved/blob/main/vignettes/birthdeath_phylogenies.Rmd" class="external-link"><code>vignettes/birthdeath_phylogenies.Rmd</code></a></small>
      <div class="d-none name"><code>birthdeath_phylogenies.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="learning-objectives">Learning objectives<a class="anchor" aria-label="anchor" href="#learning-objectives"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Estimating diversification rates under pure birth</li>
<li>Estimating diversification rates under birth-death</li>
<li>What affects speciation and extinction?</li>
</ol>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>First, we will load our required packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">LSD</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bamm-project.org/" class="external-link">BAMMtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mjanuario/evolved" class="external-link">evolved</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's also store our par() configs so </span></span>
<span><span class="co"># we can restore them whenever we change it in this tutorial</span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-phylogenetic-trees">Simulating phylogenetic trees<a class="anchor" aria-label="anchor" href="#simulating-phylogenetic-trees"></a>
</h2>
<p>Molecular phylogenies are built from DNA sequences and therefore only
include extant species. In this vignette, we will simulate and analyze
“ideal” versions of these molecular phylogenies. We know from previous
vignettes that using molecular phylogenies directly (“naively”) can lead
to spurious conclusions, as these phylogenies are missing a lot of
information. Despite this limitation, there is still a lot we can learn
about speciation and extinction from molecular phylogenies. This is what
we will do today.</p>
<p>As we dive into the realm of molecular phylogenies, keep in mind that
most groups of organisms do not have good fossil records. In such cases,
phylogenetic trees of extant species are often the only information we
will ever have about rates of speciation and/or extinction in these
groups.</p>
<p>We will be simulating molecular phylogenies with a function from our
package <code>evolved</code>, so let’s first check the arguments of
<code><a href="../reference/simulateTree.html">simulateTree()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">simulateTree</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (pars, max.taxa = Inf, max.t, min.taxa = 2, include.extinct = FALSE) </span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p><code>pars =</code> A vector containing the speciation and extinction
rates, written as <code>c(S, E)</code>.</p>
<p><code>max.taxa =</code> Maximum number of taxa to include in the
tree.</p>
<p><code>min.taxa =</code> Minimum number of taxa to include in the
tree.</p>
<p><code>max.t =</code> Maximum time of simulation.</p>
<p><code>include.extinct =</code> A logical (TRUE or FALSE) describing
if the phylogeny should include lineages that went extinct before the
simulation ended.</p>
<p>This function carries out a simulation of diversification, resulting
in a phylogenetic tree that traces the relationships between the taxa
that speciated and went extinct during the simulation. Speciation is
simulated as one lineage “giving birth” to another, bifurcating into two
new species. Extinction is of course the complete disappearance or
“death” of a lineage. Whether these events occur or do not occur is
dependent on a random number draw. Also, the simulation keeps track of
how many time steps have passed since its initiation.</p>
<p>The simulation ends when either (a) the amount of elapsed time
surpasses the maximum time for the simulation, given in the parameter
<code>max.t</code>, or (b) the number of lineages existing (“alive”) at
the current time step surpasses the maximum number of taxa, given in the
parameter <code>max.taxa</code>. These two cases are the “stopping
criteria” for the simulation, and when either occurs, the simulation
terminates and outputs a phylogenetic tree.</p>
<p>Now that you understand what is going on “under the hood” in this
simulation, let’s try to run one. Initiate a simulation as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set parameters for simulation</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Set seed so we all get same results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First, generate tree with no extinction and 6 tips</span></span>
<span><span class="va">tree_pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">E</span><span class="op">)</span>, max.taxa <span class="op">=</span> <span class="fl">6</span>, max.t <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then we reset the seed. From now on, you will </span></span>
<span><span class="co"># have different results each time you run a phylogeny:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>The <code>ape</code> package in R provides nice functions for
visualizing and manipulating phylogenetic trees. Here, we will use a
function from this package to plot the phylogenetic tree we just
simulated:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree_pb</span>, show.tip.label<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a timescale (in Mya, and zero is the time the simulation stopped):</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="700"></p>
<p>Run another simulation and plot it again. Then plot some others. Each
time you do this, vary the values you insert for speciation and
extinction rates (the vector you pass into the <code>pars</code>
argument), particularly focus on increasing or decreasing the difference
between these values. Take note of how the trees vary.</p>
<p>As you do this, you may find that the absolute magnitude of branch
lengths (the total number of lines) depends on the diversification rate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>−</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">S - E</annotation></semantics></math>),
though tree shape (general structure, or <em>topology</em>) does not.
Tree shape is, however, highly sensitive to the <strong>relative
extinction rate</strong>, or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mi>E</mi><mi>/</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">K = E / S</annotation></semantics></math>.</p>
<p>To get a sense for this, we will simulate a phylogeny with very small
relative extinction
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>/</mi><mi>S</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">E / S = 0.05</annotation></semantics></math>),
and a pure-birth tree
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>/</mi><mi>S</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">E / S = 0</annotation></semantics></math>)
for comparison.</p>
<p>Note: it doesn’t make much sense to specify
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>/</mi><mi>S</mi><mo>&gt;</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">E / S &gt;= 1</annotation></semantics></math>
because this evolutionary process will almost always go extinct before
speciating, thus leaving no tree – so we will omit this case.</p>
<p>To make for easier visualization, we will increase our maximum taxa
parameter from 6 to 100 tips.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generating tree with high relative extinction and 100 tips</span></span>
<span><span class="va">tree_lowE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span>pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.05</span><span class="op">)</span>, max.taxa<span class="op">=</span><span class="fl">100</span>, max.t <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># And a pure birth tree, holding all arguments the same except with no extinction:</span></span>
<span><span class="va">tree_pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span>pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0</span><span class="op">)</span>, max.taxa<span class="op">=</span><span class="fl">100</span>, max.t <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot both trees side by side.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree_pb</span>, show.tip.label<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree_lowE</span>, show.tip.label<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Restoring old par() configs:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<p>Now we will visualize lineage-through-time (LTT) plots for these
trees, just like we did a few weeks ago. The LTT plots contain a lot of
information about phylogenetic tree structure. Let’s see what this can
tell us about the <em>shape</em> of trees produced by different
speciation and extinction rates.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot lineage through time plots:</span></span>
<span><span class="fu"><a href="../reference/lttPlot.html">lttPlot</a></span><span class="op">(</span><span class="va">tree_pb</span>, col <span class="op">=</span> <span class="st">"blue"</span>, knitr <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lttPlot.html">lttPlot</a></span><span class="op">(</span><span class="va">tree_lowE</span>, col <span class="op">=</span> <span class="st">"red"</span>, knitr <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-7-2.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or, in a single plot:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"gray50"</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/lttPlot.html">lttPlot</a></span><span class="op">(</span><span class="va">tree_pb</span>, rel.time<span class="op">=</span><span class="cn">T</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">1.5</span>, knitr <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/lttPlot.html">lttPlot</a></span><span class="op">(</span><span class="va">tree_lowE</span>, rel.time<span class="op">=</span><span class="cn">T</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">1.5</span>, knitr <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-7-3.png" class="r-plt" alt="" width="700"></p>
<p>In the plot above, the grey line represents the expected mean of
lineages through time in a pure-birth process. As you already know, the
birth-death process is a stochastic model, so even though the average
number of species tends to follow this line, usually the actual number
of species (i.e., the blue line) will vary.</p>
<p>Are you surprised? Think about what you’ve just seen: you compared
two (or three) phylogenies, all of which have zero extinct species
shown… and yet, it appears that something seems different about the
trees! Is this what you would have expected? The fact that trees of only
extant species might have information about <strong>extinction</strong>,
even though there is no observed extinction in the tree, is potentially
very useful!</p>
<p>As an extra exercise for you to build intuition, check LTT plots with
<code>S = 0.001</code>, <code>0.01</code>, <code>0.1</code>, and
<code>1.0</code>.</p>
<p>Now, we are going to apply the simplest possible estimator of
speciation rate to our simulated phylogenetic trees to test how much
information they contain about the true rates of speciation and
extinction. We have included a simple function,
<code><a href="../reference/estimateSpeciation.html">estimateSpeciation()</a></code>, that will compute the “best” estimate
of speciation for a given tree, assuming that there is no
extinction.</p>
<p>If you are wondering, it is indeed possible to do this while allowing
extinction to be nonzero and we will do so later in lab, but the
mathematics are more complicated. So we’ll start with the simpler
model.</p>
<p>First, let’s generate a couple of phylogenies and then estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
to see how well they correspond.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span><span class="op">)</span>, max.taxa <span class="op">=</span> <span class="fl">40</span>, max.t <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, max.taxa <span class="op">=</span> <span class="fl">40</span>, max.t <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span>, max.taxa <span class="op">=</span> <span class="fl">40</span>, max.t <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/estimateSpeciation.html">estimateSpeciation</a></span><span class="op">(</span><span class="va">tree1</span><span class="op">)</span>, <span class="fu"><a href="../reference/estimateSpeciation.html">estimateSpeciation</a></span><span class="op">(</span><span class="va">tree2</span><span class="op">)</span>, <span class="fu"><a href="../reference/estimateSpeciation.html">estimateSpeciation</a></span><span class="op">(</span><span class="va">tree3</span><span class="op">)</span>,</span>
<span>         <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Estimated"</span>, <span class="st">"True"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Estimated True</span></span>
<span><span class="co">## [1,] 0.4741897  0.5</span></span>
<span><span class="co">## [2,] 1.1573038  1.0</span></span>
<span><span class="co">## [3,] 4.4019975  5.0</span></span></code></pre>
<p>Now that you have a sense for the accuracy of our estimator, let’s
simulate 100 phylogenetic trees with variable speciation rates and apply
this simple estimator. We can then ask how correlated those estimates
are with the true rates. In other words, how well can we recover the
true rates using the simple estimator?</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REPS</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">REPS</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>true_S<span class="op">=</span><span class="va">x</span>, true_E<span class="op">=</span><span class="va">x</span>, est_S<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">REPS</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># pick a speciation rate with any value between 0 and 2:</span></span>
<span>    <span class="va">sim_S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="co"># in the pure birth, extinction rate is always zero</span></span>
<span>    <span class="va">sim_E</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    </span>
<span>    <span class="co"># simulate tree:    </span></span>
<span>    <span class="va">tree_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span>pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_S</span>, <span class="va">sim_E</span><span class="op">)</span>, </span>
<span>                             max.taxa<span class="op">=</span><span class="fl">50</span>, max.t <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span> </span>
<span>    <span class="co">#fitting the model:</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimateSpeciation.html">estimateSpeciation</a></span><span class="op">(</span><span class="va">tree_sim</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">true_S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sim_S</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">true_E</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sim_E</span></span>
<span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">est_S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s check our estimates (notice that warm colors mean more points
aggregated):</p>
<p>For speciation rates:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/LSD/man/heatscatter.html" class="external-link">heatscatter</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">true_S</span>, <span class="va">res</span><span class="op">$</span><span class="va">est_S</span>, </span>
<span>            xlab <span class="op">=</span> <span class="st">"Simulated speciation rate"</span>,</span>
<span>            ylab<span class="op">=</span><span class="st">"Estimated speciation rate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then,we add the 1:1 line  (i.e. a perfect estimation)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="700"></p>
<p>Remember these phylogenies were created through a pure-birth process,
thus we do not need to estimate extinction rates.</p>
<p>Now you might ask: what if extinction really is not zero? How bad
would our speciation estimates be?</p>
<p>To explore this, let’s simulate a set of phylogenies under low and
high relative extinction (E / S = 0.05 and E / S = 0.95) and do the same
thing we did previously, again estimating speciation under the simple
(pure birth) estimator.</p>
<p>While you wait for the next chunk of code to run, answer the question
just after it:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REPS</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">REPS</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>true_S<span class="op">=</span><span class="va">x</span>, true_E<span class="op">=</span><span class="va">x</span>, est_S<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">REPS</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Pick a speciation rate with any value between 0 and 2:</span></span>
<span>    <span class="va">sim_S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="co"># Now we will change the extinction fraction to always equal 0.05</span></span>
<span>    <span class="va">sim_E</span> <span class="op">&lt;-</span> <span class="va">sim_S</span> <span class="op">*</span> <span class="fl">0.05</span></span>
<span>    </span>
<span>    <span class="co"># simulate tree:    </span></span>
<span>    <span class="va">tree_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span>pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_S</span>, <span class="va">sim_E</span><span class="op">)</span>, </span>
<span>                             max.taxa<span class="op">=</span><span class="fl">50</span>, max.t <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span> </span>
<span>    <span class="co">#fitting the model:</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimateSpeciation.html">estimateSpeciation</a></span><span class="op">(</span><span class="va">tree_sim</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">true_S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sim_S</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">true_E</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sim_E</span></span>
<span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">est_S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s check our estimates for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>/</mi><mi>S</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">E/S = 0.05</annotation></semantics></math>
case.</p>
<p>For speciation rates:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/LSD/man/heatscatter.html" class="external-link">heatscatter</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">true_S</span>, <span class="va">res</span><span class="op">$</span><span class="va">est_S</span>, </span>
<span>            xlab <span class="op">=</span> <span class="st">"Simulated speciation rate"</span>,</span>
<span>            ylab<span class="op">=</span><span class="st">"Estimated speciation rate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Then,we add the 1:1 line  (i.e. a perfect estimation)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" alt="" width="700"></p>
<p>Now, we will use a more complex estimation procedure. We will
estimate parameters by using a more sophisticated estimator that allows
extinction and speciation rates to be nonzero. The mathematics of this
are beyond the scope of this vignette, but we have provided a handy
function that does the model-fitting for you, assuming rates are
constant (through time and species): <code><a href="../reference/fitCRBD.html">fitCRBD()</a></code>. For
example:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.95</span><span class="op">)</span>, max.taxa <span class="op">=</span> <span class="fl">50</span>, max.t <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># estimating:</span></span>
<span><span class="fu"><a href="../reference/fitCRBD.html">fitCRBD</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        S        E </span></span>
<span><span class="co">## 1.440485 1.497985</span></span></code></pre>
<p>Let’s repeat our simulation procedure, but this time we will fit a
model where extinction can be nonzero. We won’t display the plots here,
but feel free to copy and paste the code into your R console to see the
results yourself!</p>
<p>NOTE: if you see the message
<code>Error in simulateTree(pars = c(sim_S, sim_E), max.taxa = 50) : Too many trees going extinct</code>
just run the chunk code again.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REPS</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">REPS</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>true_S<span class="op">=</span><span class="va">x</span>, true_E<span class="op">=</span><span class="va">x</span>, est_S<span class="op">=</span><span class="va">x</span>, est_E<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">REPS</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># pick a speciation rate with any value between 0 and 2:</span></span>
<span>    <span class="va">sim_S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="co"># pick a relative extinction rate:</span></span>
<span>    <span class="va">rel_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>  , <span class="fl">0</span>, <span class="fl">0.95</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="co"># calculate E from that extinction fraction</span></span>
<span>    <span class="va">sim_E</span> <span class="op">&lt;-</span> <span class="va">sim_S</span> <span class="op">*</span> <span class="va">rel_ex</span> </span>
<span>    </span>
<span>    <span class="co"># simulate tree:    </span></span>
<span>    <span class="va">tree_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateTree.html">simulateTree</a></span><span class="op">(</span>pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_S</span>, <span class="va">sim_E</span><span class="op">)</span>, </span>
<span>                             max.taxa<span class="op">=</span><span class="fl">50</span>, max.t <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span> </span>
<span>    <span class="co"># fitting the model:</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitCRBD.html">fitCRBD</a></span><span class="op">(</span><span class="va">tree_sim</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">true_S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sim_S</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">true_E</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sim_E</span></span>
<span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">est_S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">[</span><span class="st">"S"</span><span class="op">]</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">est_E</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">[</span><span class="st">"E"</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Don’t forget to check our estimates for the speciation rate:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/LSD/man/heatscatter.html" class="external-link">heatscatter</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">true_S</span>, <span class="va">res</span><span class="op">$</span><span class="va">est_S</span>, </span>
<span>            xlab <span class="op">=</span> <span class="st">"Simulated speciation rate"</span>,</span>
<span>            ylab<span class="op">=</span><span class="st">"Estimated speciation rate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then,we add the 1:1 line  (i.e. a perfect estimation)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Making a simple linear model:</span></span>
<span><span class="va">S_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">est_S</span><span class="op">~</span><span class="va">res</span><span class="op">$</span><span class="va">true_S</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># And checking how much variation is explained</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S_lm</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span></code></pre></div>
<p>And for the extinction-speciation ratio:</p>
<p><strong>Note:</strong> It is not adequate to directly correlate
simulated and estimated extinction rates. This happens because we can
only generate phylogenies when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>&lt;</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">E &lt; S</annotation></semantics></math>,
and thus we do not allow extinction to vary in a way that is completely
independent from speciation. However, when we correlate simulated and
estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mi>E</mi><mi>/</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">K = E/S</annotation></semantics></math>,
we ameliorate this particular issue enough (for this vignette).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_K</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">true_E</span><span class="op">/</span><span class="va">res</span><span class="op">$</span><span class="va">true_S</span></span>
<span><span class="va">est_K</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">est_E</span><span class="op">/</span><span class="va">res</span><span class="op">$</span><span class="va">est_S</span></span>
<span></span>
<span><span class="fu">LSD</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/LSD/man/heatscatter.html" class="external-link">heatscatter</a></span><span class="op">(</span><span class="va">sim_K</span>, <span class="va">est_K</span>, </span>
<span>                 xlab <span class="op">=</span> <span class="st">"Simulated E/S"</span>,</span>
<span>                 ylab<span class="op">=</span><span class="st">"Estimated E/S"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#making a simple linear model:</span></span>
<span><span class="va">K_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">est_K</span><span class="op">~</span><span class="va">sim_K</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">K_lm</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span>
<span></span>
<span><span class="co">#Then,we add the 1:1 line  (i.e. a perfect estimation)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Think for a moment on the result of this simulation. We actually fit
a constant-rate birth-death model to a constant-rate simulated
phylogeny. We have very few reasons to expect that real phylogenies will
be as constant as this – this is especially true for clades that are
older or that have colonized many different environments. The
scatterplot you just saw is the <em>ceiling</em> of how well extinction
rates can possibly be estimated.</p>
<p>In the empirical example in the next section we will focus our
attention on speciation rates because they can be estimated with higher
precision from molecular phylogenies. Remember, though, that extinction
is potentially as important as speciation in terms of what factors shape
temporal diversity dynamics.</p>
</div>
<div class="section level2">
<h2 id="what-affects-speciation-and-extinction">What affects speciation and extinction?<a class="anchor" aria-label="anchor" href="#what-affects-speciation-and-extinction"></a>
</h2>
<p>Another layer of complexity that real phylogenies might have is the
possibility that diversification rates can vary among lineages. This may
happen if traits that differ between lineages affect speciation or
extinction rates.</p>
<p>To test this, we will use the molecular, time-calibrated phylogeny of
whales, already included as a dataset in the package
<code>BAMMtools</code>. We can access it by typing:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"whale_phylo"</span><span class="op">)</span></span></code></pre></div>
<p>Note that many different types of whales are included here:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotPaintedWhales.html">plotPaintedWhales</a></span><span class="op">(</span>knitr <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##                    1        Baleen whales        Beaked whales </span></span>
<span><span class="co">##              "black"            "#DF536B"            "#61D04F" </span></span>
<span><span class="co">## Belugas and narwhals             Dolphins     Other mysticetes </span></span>
<span><span class="co">##            "#2297E6"            "#28E2E5"            "#CD0BBC" </span></span>
<span><span class="co">##            Porpoises </span></span>
<span><span class="co">##            "#F5C710"</span></span></code></pre>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-18-1.png" class="r-plt" alt="" width="576"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Restoring old par() configs:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<p>One might argue that species with high dispersal capacity will be
less likely to speciate, because they can maintain population
connectivity (i.e., high gene flow) over larger geographic areas
(similarly to what is disucssed in Kisel and Barraclough 2010). In
general, body size correlates with dispersal distance across
vertebrates, so we might expect large-bodied whales to have higher
dispersal capacity than small-bodied whales. Thus, we might predict an
association between body size and speciation rate across whales, given
significant variation in whale body size.</p>
<p>Now, let’s test this correlation. To do this, we will first load data
on whale mass (originally downloaded from PanTheria; Jones <em>et
al</em>, 2009) and species-specific speciation rates (originally
downloaded from Rabosky, 2014)). Species-specific speciation rates were
estimated by fitting birth-death models to molecular phylogenies and
allowing diversification rates to vary both through time and among
clades. We provide Rabosky’s (2014) results here as a quick exploration
of how an analysis using such a model might be conducted.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data_whales</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_whales</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                      species log_mass          S   color</span></span>
<span><span class="co">## 1         Balaena_mysticetus 18.19367 0.07272368 #CD0BBC</span></span>
<span><span class="co">## 2 Balaenoptera_acutorostrata 15.53597 0.07111798 #DF536B</span></span>
<span><span class="co">## 3      Balaenoptera_borealis 16.91137 0.07108088 #DF536B</span></span>
<span><span class="co">## 4         Balaenoptera_edeni 16.81124 0.07075967 #DF536B</span></span>
<span><span class="co">## 5      Balaenoptera_musculus 18.85455 0.07173890 #DF536B</span></span>
<span><span class="co">## 6      Balaenoptera_physalus 17.67637 0.07172809 #DF536B</span></span></code></pre>
<p>Let’s make a simple scatterplot, coloring points by clade. After
that, we will add a simple linear model of body mass on speciation
rate.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data_whales</span><span class="op">$</span><span class="va">log_mass</span>, <span class="va">data_whales</span><span class="op">$</span><span class="va">S</span>, pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Mass (log(g))"</span>, ylab<span class="op">=</span><span class="st">"Speciation rate"</span>, col<span class="op">=</span><span class="va">data_whales</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topright"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"other odontocetes"</span>,<span class="st">"Baleen whales"</span>,</span>
<span>      <span class="st">"Beaked whales"</span>,<span class="st">"Belugas and narwhals"</span>,</span>
<span>      <span class="st">"Dolphins"</span>,<span class="st">"Other mysticetes"</span>,<span class="st">"Porpoises"</span><span class="op">)</span>,</span>
<span>    pch<span class="op">=</span><span class="fl">16</span>,pt.cex<span class="op">=</span><span class="fl">1.5</span>,pt.bg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,</span>
<span><span class="st">"#DF536B"</span>,<span class="st">"#61D04F"</span>,<span class="st">"#2297E6"</span>,<span class="st">"#28E2E5"</span>,</span>
<span><span class="st">"#CD0BBC"</span>,<span class="st">"#F5C710"</span><span class="op">)</span>,bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then we construct a linear model:</span></span>
<span><span class="va">whales_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">data_whales</span><span class="op">$</span><span class="va">S</span><span class="op">~</span><span class="va">data_whales</span><span class="op">$</span><span class="va">log_mass</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">whales_lm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = data_whales$S ~ data_whales$log_mass)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##       Min        1Q    Median        3Q       Max </span></span>
<span><span class="co">## -0.111355 -0.038805  0.004617  0.047447  0.090063 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)           0.372832   0.036345  10.258 8.51e-16 ***</span></span>
<span><span class="co">## data_whales$log_mass -0.017881   0.002662  -6.716 3.48e-09 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.052 on 73 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.3819, Adjusted R-squared:  0.3735 </span></span>
<span><span class="co">## F-statistic: 45.11 on 1 and 73 DF,  p-value: 3.483e-09</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="va">whales_lm</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-20-1.png" class="r-plt" alt="" width="700"></p>
<p>What do you think? Does this relationship support our hypothesis that
size influences speciation rate?</p>
<p>Before you answer, let’s plot the data with the phylogeny.</p>
<div class="section level3">
<h3 id="shifts-in-diversification-rates">Shifts in diversification rates<a class="anchor" aria-label="anchor" href="#shifts-in-diversification-rates"></a>
</h3>
<p>Recall that in real phylogenies, diversification rates can vary among
clades and through time, so one possible question is: <em>where and
when</em> are these shifts on the phylogeny?</p>
<p>We can use the datasets on whales in the package
<code>BAMMtools</code> to explore this possibility.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">whales</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">events.whales</span><span class="op">)</span></span></code></pre></div>
<p>Let’s read in these files and draw a color-coded phylogeny where
warmer colors indicate higher speciation rates. Below, the phylogeny on
the right contains information on speciation rate, the one on the right
is merely color-coded by clade.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAMMtools/man/getEventData.html" class="external-link">getEventData</a></span><span class="op">(</span><span class="va">whales</span>, <span class="va">events.whales</span>, burnin <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Processing event data from data.frame</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Discarded as burnin: GENERATIONS &lt;  995000</span></span>
<span><span class="co">## Analyzing  1801  samples from posterior</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Setting recursive sequence on tree...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Done with recursive sequence</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">#making a panel</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotPaintedWhales.html">plotPaintedWhales</a></span><span class="op">(</span>ftype<span class="op">=</span><span class="st">"off"</span>, direction<span class="op">=</span><span class="st">"rightwards"</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.1</span>,<span class="fl">0</span>,<span class="fl">2.1</span>,<span class="fl">2.1</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">TRUE</span>, knitr <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##                    1        Baleen whales        Beaked whales </span></span>
<span><span class="co">##              "black"            "#DF536B"            "#61D04F" </span></span>
<span><span class="co">## Belugas and narwhals             Dolphins     Other mysticetes </span></span>
<span><span class="co">##            "#2297E6"            "#28E2E5"            "#CD0BBC" </span></span>
<span><span class="co">##            Porpoises </span></span>
<span><span class="co">##            "#F5C710"</span></span></code></pre>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-22-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/BAMMtools/man/plot.html" class="external-link">plot.bammdata</a></span><span class="op">(</span><span class="va">x</span>, lwd <span class="op">=</span> <span class="fl">3</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.1</span>,<span class="fl">0</span>,<span class="fl">2.1</span>,<span class="fl">2.1</span><span class="op">)</span>, direction <span class="op">=</span> <span class="st">"leftwards"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Restoring old par() configs:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_phylogenies_files/figure-html/unnamed-chunk-22-2.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References:<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Jones, K. E., Bielby, J., Cardillo, M., Fritz, S. A., O’Dell, J.,
Orme, C. D. L., … &amp; Purvis, A. (2009). PanTHERIA: a species‐level
database of life history, ecology, and geography of extant and recently
extinct mammals: Ecological Archives E090‐184. Ecology, 90(9),
2648-2648.</p>
<p>Kisel, Y., &amp; Barraclough, T. G. (2010). Speciation has a spatial
scale that depends on levels of gene flow. The American Naturalist,
175(3), 316-334.</p>
<p>Rabosky, D. L. (2014). Automatic detection of key innovations, rate
shifts, and diversity-dependence on phylogenetic trees. PloS one, 9(2),
e89543.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matheus Januario, Jennifer Auler, Andressa Viol, Daniel Rabosky.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
