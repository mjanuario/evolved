<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Birth-death models and deep time • evolved</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Birth-death models and deep time">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">evolved</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-book"></span> Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html"><span class="fa fa-book-open"></span> Vignettes &amp; Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mjanuario/evolved" aria-label="GitHub repository"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Birth-death models and deep time</h1>
                        <h4 data-toc-skip class="author">Matheus
Januario, Andressa Viol, and Daniel Rabosky</h4>
            
            <h4 data-toc-skip class="date">Jan 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mjanuario/evolved/blob/main/vignettes/birthdeath_deeptime.Rmd" class="external-link"><code>vignettes/birthdeath_deeptime.Rmd</code></a></small>
      <div class="d-none name"><code>birthdeath_deeptime.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="learning-objectives">Learning objectives<a class="anchor" aria-label="anchor" href="#learning-objectives"></a>
</h2>
<ol style="list-style-type: decimal">
<li>The birth-death (BD) model</li>
<li>Deterministic expectations of the birth-death model</li>
<li>Estimation under the simple birth-death</li>
<li>Effects of variation on the net diversification rate</li>
<li>The birth-death model is a stochastic process</li>
<li>Adding in extinction</li>
<li>Age-richness models and empirical richness through time</li>
</ol>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Today we will work with the main mathematical model used in diversity
dynamics: the birth-death model. The main idea of the model is simple:
at any instant in time, species can (I) split into two, (II) go extinct,
or (III) do nothing. The model can be fully described
(i.e. parameterized) by the rate of speciation (the “births”) and the
rate of extinction (the “deaths”).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mjanuario/evolved" class="external-link">evolved</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-birth-death-bd-model">The birth-death (BD) model<a class="anchor" aria-label="anchor" href="#the-birth-death-bd-model"></a>
</h2>
<p>The birth-death model is a simple stochastic process that is widely
used to quantitatively study diversification (speciation and
extinction). It is used in other contexts as well, as in ecology or in
physics.</p>
<p>The birth-death model we will use here has two parameters:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>,
the <em>rate of speciation</em> (the rate at which one species will
split into two species), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
the <em>rate of extinction</em>. Usually, these rates are “per capita”
(or “per lineage”), meaning that the total rate of speciation for a
clade of N species would be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>×</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">N \times S</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>×</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">N \times E</annotation></semantics></math>
for extinction.</p>
<p>The compound parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>−</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">S - E</annotation></semantics></math>
is known as the net diversification rate: it is the rate at which new
species are produced, minus the rate at which they go extinct. If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>−</mo><mi>E</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">S - E &gt; 0</annotation></semantics></math>,
the net production of new species is positive and the clade tends to
increase exponentially in diversity through time. When
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>−</mo><mi>E</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">S - E &lt; 0</annotation></semantics></math>,
the clade will lose species through time on average, meaning the clade
will be strongly biased to go extinct.</p>
<div class="section level4">
<h4 id="glossary">Glossary:<a class="anchor" aria-label="anchor" href="#glossary"></a>
</h4>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">S =</annotation></semantics></math>
speciation rate (per lineage)</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">E =</annotation></semantics></math>
extinction rate (per lineage)</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>−</mo><mi>E</mi><mo>=</mo><mi>R</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">S - E = R =</annotation></semantics></math>
net diversification rate</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mfrac><mi>E</mi><mi>S</mi></mfrac><mo>=</mo></mrow><annotation encoding="application/x-tex">K = \frac{E}{S} =</annotation></semantics></math>
relative extinction rate (becomes important later)</p>
<p><strong>pure-birth model:</strong> a special type of birth-death
model where only speciation happens (i.e., E = 0)</p>
</div>
</div>
<div class="section level2">
<h2 id="deterministic-expectations-of-the-bd-model">Deterministic expectations of the BD model<a class="anchor" aria-label="anchor" href="#deterministic-expectations-of-the-bd-model"></a>
</h2>
<p>The expected species richness under the birth-death model is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>t</mi></msub><mo>=</mo><msub><mi>N</mi><mn>0</mn></msub><mo>*</mo><msup><mi>e</mi><mrow><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>−</mo><mi>E</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup></mrow><annotation encoding="application/x-tex">\begin{equation}
N_t = N_0 * e^{t (S - E)}
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mn>0</mn></msub><annotation encoding="application/x-tex">N_0</annotation></semantics></math>
is the starting number of species,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is the elapsed time, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>t</mi></msub><annotation encoding="application/x-tex">N_t</annotation></semantics></math>
is the number of species at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
This is just a simple exponential growth model that you’ve seen before
(recall the intro to popgen vignette, where we discussed Malthusian
growth), except now we are dealing with the birth and death rates of
<em>species</em> and not individuals.</p>
</div>
<div class="section level2">
<h2 id="estimation-under-the-simplest-bd">Estimation under the simplest BD<a class="anchor" aria-label="anchor" href="#estimation-under-the-simplest-bd"></a>
</h2>
<p>Let’s imagine that we are interested in the diversification of
mammals, which currently have around 5500 extant species. Can we
estimate how fast mammals diversified through time?</p>
<p>Assume that we know that the first of all mammals existed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>164.9</mn><annotation encoding="application/x-tex">164.9</annotation></semantics></math>
million years ago. At this time point, there were
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N = 1</annotation></semantics></math>
species in this group. Thus, we initiate a model where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>t</mi></msub><mo>=</mo><mn>5500</mn></mrow><annotation encoding="application/x-tex">N_t = 5500</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>0</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N_0 = 1</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>164.9</mn></mrow><annotation encoding="application/x-tex">t = 164.9</annotation></semantics></math>.
What is our estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo><mi>S</mi><mo>−</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">R = S - E</annotation></semantics></math>?</p>
<p>We can make a simple estimator for the net diversification rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
under the birth-death process just by rearranging equation (1) above. We
start with:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>t</mi></msub><mo>=</mo><msub><mi>N</mi><mn>0</mn></msub><mo>*</mo><msup><mi>e</mi><mrow><mi>R</mi><mi>t</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\begin{equation}
N_t = N_0 * e^{Rt}
\end{equation}</annotation></semantics></math></p>
<p>and solve for R, giving:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo><mfrac><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>t</mi></mfrac></mrow><annotation encoding="application/x-tex">\begin{equation}
R = \frac{log(N_t) - log(N_0)}{t}
\end{equation}</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="effects-of-variation-on-the-net-diversification-rate">Effects of variation on the net diversification rate<a class="anchor" aria-label="anchor" href="#effects-of-variation-on-the-net-diversification-rate"></a>
</h2>

</div>
<div class="section level2">
<h2 id="the-birth-death-model-is-a-stochastic-process">The birth-death model is a stochastic process<a class="anchor" aria-label="anchor" href="#the-birth-death-model-is-a-stochastic-process"></a>
</h2>
<p>Let’s imagine that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
we’ve computed for mammals in Q3 is in fact the <em>true</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>.
What if we replayed the tape of life for mammals many times, allowing
the clade to diversify over and over again (always starting from only
one species). Do you think we would get the exact same number of species
every time?</p>
<p>To explore this, we will simulate evolutionary histories of mammals
under our value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>.</p>
<p>Fundamentally, the birth-death process is stochastic. We’ve been
speaking of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
as rates, but it is more appropriate now to think of them as relative
probabilities – the relative probabilities that each species alive in
the simulation will either split into two or die, respectively.</p>
<p>Simulating the birth-death process is very easy, but the details
involve some basic probability theory and calculus that go beyond the
scope here. So, we have given you a function that simulates the number
of species in a clade, given a set of parameters.</p>
<p>To simulate a single evolutionary history starting with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>0</mn></msub><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">N_0 = 2</annotation></semantics></math>
species, for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">t = 10</annotation></semantics></math>
million years, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">S = 1</annotation></semantics></math>
and <em>no extinction</em>
(i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">E= 0</annotation></semantics></math>),
we should type:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/simulateBirthDeathRich.html">simulateBirthDeathRich</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">10</span>, S <span class="op">=</span> <span class="fl">1</span>, E <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 14759</span></span></code></pre>
<p>Try it yourself: Simulate a history of mammals using the function
<code><a href="../reference/simulateBirthDeathRich.html">simulateBirthDeathRich()</a></code>. Did you get something close to
the true value of 5500 species?</p>
</div>
<div class="section level2">
<h2 id="adding-in-extinction">Adding in extinction<a class="anchor" aria-label="anchor" href="#adding-in-extinction"></a>
</h2>
<p>In previous exercises, we have been ignoring extinction by setting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">E = 0</annotation></semantics></math>.
But the fossil record tells us that the extinction rate has been nearly
equal to the speciation rate for much of the history of mammals. So,
let’s assume that E is 99% of the speciation rate, or K = E/S =
0.99.</p>
</div>
<div class="section level2">
<h2 id="age-richness-models-and-empirical-richness-through-time">Age-richness models and empirical richness through time<a class="anchor" aria-label="anchor" href="#age-richness-models-and-empirical-richness-through-time"></a>
</h2>
<p>Now, we will apply this method to a real richness curve, and compare
our estimates with actual data. We will use the dataset provided by
Rabosky &amp; Benson (2021).</p>
<p>First we will read in our data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"timeseries_fossil"</span><span class="op">)</span></span></code></pre></div>
<p>We can select among many possible clades to run our analysis:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">timeseries_fossil</span><span class="op">$</span><span class="va">clade</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "anth"        "art"         "biv"         "bryo"        "ceph"       </span></span>
<span><span class="co">##  [6] "chon"        "crin"        "ech"         "gast"        "ling"       </span></span>
<span><span class="co">## [11] "ostr"        "tril"        "foram"       "graptoloids" "dinosauria"</span></span></code></pre>
<p><code>anth</code> = Anthozoan corals</p>
<p><code>art</code> = Articulata (an extant subclass of “sea lilies” and
“feather stars” within Echinodermata)</p>
<p><code>biv</code> = Bivalve mollusks</p>
<p><code>bryo</code> = Bryozoans</p>
<p><code>ceph</code> = Cephalopod mollusks</p>
<p><code>chon</code> = Cartilaginous fishes</p>
<p><code>crin</code> = The extinct “sea lilies” and “feather stars”</p>
<p><code>ech</code> = Sea urchins</p>
<p><code>gast</code> = Gastropod mollusks</p>
<p><code>ling</code> = A class of brachiopods</p>
<p><code>ostr</code> = A class of Crustaceans</p>
<p><code>tril</code> = Trilobites</p>
<p><code>foram</code> = Foraminifers</p>
<p><code>dinosauria</code> = Non-avian, extinct dinosaurs</p>
<p><code>graptoloids</code> = An extinct group of colonial animals</p>
<p>What we will do is fit a birth-death model to a clade’s
diversification trajectory, but instead of using the present as the
reference point for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>t</mi></msub><annotation encoding="application/x-tex">N_t</annotation></semantics></math>,
and calculating the diversity trajectory up to the present day, we will
choose an arbitrary point in the past and use it as a reference point
instead. This will allow us to then project our birth-death model to the
actual present, and see if the model can properly predict how diversity
has changed since our arbitrary reference point in the past.</p>
<p>To do this, we will do the following:</p>
<p><strong>Step 1:</strong> Choose a dataset.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here we will use dinosaurs:</span></span>
<span><span class="va">dino_rich</span> <span class="op">&lt;-</span> <span class="va">timeseries_fossil</span><span class="op">[</span><span class="va">timeseries_fossil</span><span class="op">$</span><span class="va">clade</span><span class="op">==</span><span class="st">"dinosauria"</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          clade     source stem_age rel_time time_ma richness</span></span>
<span><span class="co">## 569 dinosauria Benson2016    251.9    175.9      76      853</span></span>
<span><span class="co">## 570 dinosauria Benson2016    251.9    170.9      81      878</span></span>
<span><span class="co">## 571 dinosauria Benson2016    251.9    165.9      86      840</span></span>
<span><span class="co">## 572 dinosauria Benson2016    251.9    160.9      91      748</span></span>
<span><span class="co">## 573 dinosauria Benson2016    251.9    155.9      96      748</span></span>
<span><span class="co">## 574 dinosauria Benson2016    251.9    150.9     101      791</span></span></code></pre>
<p><br></p>
<p><strong>Step 2:</strong> Choose a point in time for which we have
data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  76  81  86  91  96 101 106 111 116 121 126 131 136 141 146 151 156 161 166</span></span>
<span><span class="co">## [20] 171 176 181 186 191 196 201 206 211 216 221</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We will use the early Jurassic, around 201 Mya, as our reference for this analysis</span></span>
<span><span class="va">t_obs</span> <span class="op">&lt;-</span> <span class="fl">201</span></span>
<span></span>
<span><span class="va">rich_early_J</span> <span class="op">&lt;-</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span><span class="op">[</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span><span class="op">==</span><span class="va">t_obs</span><span class="op">]</span> </span>
<span><span class="co"># species richness from this time point</span></span>
<span><span class="va">rich_early_J</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 278</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotting our data and our point of observation:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>     y<span class="op">=</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Millions of years ago"</span>, ylab <span class="op">=</span> <span class="st">"Dino species richness"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># connecting the dots:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>     y<span class="op">=</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># highlighting the point we will pick:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t_obs</span>, y<span class="op">=</span><span class="va">rich_early_J</span>, col<span class="op">=</span><span class="st">"red"</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">t_obs</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_deeptime_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="700"></p>
<p><strong>Step 3:</strong> Estimate R using the methods above.</p>
<p>As we saw above, to estimate R, we need to know
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>t</mi></msub><annotation encoding="application/x-tex">N_t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mn>0</mn></msub><annotation encoding="application/x-tex">N_0</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
Let’s use our arbitrary reference time point, 201 Mya, as the ‘present’,
and calculate values for these terms.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Richness at the stem age of the dinosaurs:</span></span>
<span><span class="va">rich_0</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># The start age of our clade marks time 0 for diversification:</span></span>
<span><span class="va">t0</span> <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">stem_age</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Since we now know N_t, N_0, and the elapsed time, calculate R:</span></span>
<span><span class="va">R_dino</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">rich_early_J</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">t0</span> <span class="op">-</span> <span class="va">t_obs</span><span class="op">)</span></span>
<span><span class="va">R_dino</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.1105623</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot our data and project the richness since the beginning of our time series:</span></span>
<span><span class="va">time_from_t0</span> <span class="op">=</span> <span class="va">t0</span> <span class="op">-</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span></span>
<span></span>
<span><span class="va">projected_rich</span> <span class="op">=</span> <span class="va">rich_0</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">R_dino</span> <span class="op">*</span> <span class="va">time_from_t0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Finally, we calculate the difference between our projections and the data:</span></span>
<span><span class="va">projected_rich</span><span class="op">-</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  2.793303e+08  1.607067e+08  9.245907e+07  5.319421e+07  3.060391e+07</span></span>
<span><span class="co">##  [6]  1.760699e+07  1.012955e+07  5.827550e+06  3.352453e+06  1.928400e+06</span></span>
<span><span class="co">## [11]  1.109044e+06  6.377082e+05  3.667199e+05  2.107627e+05  1.210567e+05</span></span>
<span><span class="co">## [16]  6.938300e+04  3.960939e+04  2.265741e+04  1.281673e+04  7.171539e+03</span></span>
<span><span class="co">## [21]  4.070215e+03  2.327329e+03  1.298801e+03  6.788675e+02  2.542010e+02</span></span>
<span><span class="co">## [26] -5.684342e-14 -6.205826e+01 -1.179807e+02 -1.630585e+02 -2.045412e+02</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plotting the difference between our projections and the data:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>     y<span class="op">=</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     <span class="op">)</span></span>
<span><span class="co"># Connecting the dots:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>     y<span class="op">=</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Highlighting our point of observation again:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t_obs</span>, y<span class="op">=</span><span class="va">rich_early_J</span>, col<span class="op">=</span><span class="st">"red"</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now, we will add the predicted richness curve based on our estimations:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>     y<span class="op">=</span><span class="va">projected_rich</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Finally, we plot the differences between our projections and our data using bars:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>         x1 <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>         y0 <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span>,</span>
<span>         y1 <span class="op">=</span> <span class="va">projected_rich</span>,</span>
<span>         col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_deeptime_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="" width="700"></p>
<p>The current axis scale does not allow us to properly visualize the
discrepancy between our prediction and the data. So let’s plot again,
re-scaling the y-axis:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#we can plot the data again, this time with extra care with the scale of our axes:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>     y<span class="op">=</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     </span>
<span>     <span class="co">#we will change the y-axis limits to fit all our calculations:</span></span>
<span>     ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span>, <span class="va">projected_rich</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span>, <span class="va">projected_rich</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     <span class="op">)</span></span>
<span></span>
<span><span class="co">#connecting the dots:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>     y<span class="op">=</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#highlighting our observation point:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t_obs</span>, y<span class="op">=</span><span class="va">rich_early_J</span>, col<span class="op">=</span><span class="st">"red"</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#adding the predictions of the model:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>     y<span class="op">=</span><span class="va">projected_rich</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Finally, we plot the differences between our projections and our data using bars:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>         x1 <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">time_ma</span>,</span>
<span>         y0 <span class="op">=</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span>,</span>
<span>         y1 <span class="op">=</span> <span class="va">projected_rich</span>,</span>
<span>         col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_deeptime_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="" width="700"></p>
<p>What do you think? Does this model fit our data well?</p>
<p>Now, let’s divide the error of our estimates by the actual data to
determine what the scale of our error is, in terms of a percentage.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perc_error</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">projected_rich</span> <span class="op">-</span> <span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span><span class="op">)</span><span class="op">/</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">richness</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">perc_error</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -87.03881</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">perc_error</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 32746816</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">perc_error</span>, xlab <span class="op">=</span> <span class="st">"Error as a percentage of the data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthdeath_deeptime_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level2">
<h2 id="some-food-for-thought">Some food for thought:<a class="anchor" aria-label="anchor" href="#some-food-for-thought"></a>
</h2>
<ol style="list-style-type: upper-alpha">
<li><p>What do you think of an estimator that can underestimate by 87%
or can overestimate the data by 32,746,816%?</p></li>
<li><p>How many species of dinosaurs does this model predict immediately
before the asteroid impact (mass extinction) at the K-Pg
boundary?</p></li>
</ol>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">proj_rich_dinos_KPg</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">R_dino</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">dino_rich</span><span class="op">$</span><span class="va">stem_age</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">66</span><span class="op">)</span></span>
<span><span class="va">proj_rich_dinos_KPg</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 292704971</span></span></code></pre>
<p>What do you think of this estimate? Before answering, consider that
current estimates for the total number of species on Earth are fewer
than 10 million species overall.</p>
</div>
<div class="section level2">
<h2 id="references">References:<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Rabosky, D. L., &amp; Benson, R. B. (2021). Ecological and
biogeographic drivers of biodiversity cannot be resolved using clade
age-richness data. Nature communications, 12(1), 1-10.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matheus Januario, Jennifer Auler, Andressa Viol, Daniel Rabosky.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
